{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Credit Score API - Stori</title>
    <link rel="stylesheet" href="{% static 'api_docs/style.css' %}">
</head>
<body>
    <header>
        <h1>Final Credit Score API</h1>
        <p>Consumer Credit Scoring</p>
    </header>

    <div class="container">
        <a href="{% url 'api_docs:index' %}" class="back-link">← Back to Documentation</a>

        <div class="section">
            <h2>Overview</h2>
            <p>Combines all analyses (Bank Statement + ITR + Credit Report + Assets) to generate final credit score and loan recommendation.</p>

            <h3>Endpoint</h3>
            <div class="endpoint">
                <span class="method">POST</span>
                <code>https://mycfo.club/stori/api/customer/credit-scoring/score/</code>
            </div>

            <h3>Authentication</h3>
            <div class="code-block">
<pre>X-API-Key: your_api_key_here
Content-Type: application/json</pre>
            </div>
        </div>

        <div class="section">
            <h2>Request Body</h2>
            <p><strong>Important:</strong> This API requires the features JSON returned from previous analysis APIs.</p>
            
            <h3>Sample Input JSON</h3>
            <div class="code-block">
<pre>{
  "customer_name": "Rahul Sharma",
  "customer_pan": "ABCDE1234F",
  "loan_amount": 500000,
  "loan_tenure_months": 24,
  
  "bank_statement_features": {
    "monthly_income": 120000,
    "monthly_expense": 65000,
    "income_stability": 0.92,
    "avg_balance": 110000,
    "estimated_emi": 22000,
    "bounce_rate": 0
  },
  
  "itr_features": {
    "annual_income": 1440000,
    "monthly_income_itr": 120000,
    "tax_compliance_score": 0.98,
    "filing_on_time": true
  },
  
  "credit_report_features": {
    "credit_score": 760,
    "total_debt": 3845000,
    "current_emi": 22000,
    "dpd_last_6_months": 0
  },
  
  "asset_features": {
    "total_assets": 11200000,
    "liquid_assets": 2400000
  }
}</pre>
            </div>

            <h3>Request Parameters</h3>
            <table>
                <thead>
                    <tr>
                        <th>Field</th>
                        <th>Type</th>
                        <th>Required</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>customer_name</td>
                        <td>string</td>
                        <td>Yes</td>
                        <td>Full name of the customer</td>
                    </tr>
                    <tr>
                        <td>customer_pan</td>
                        <td>string</td>
                        <td>Yes</td>
                        <td>PAN card number</td>
                    </tr>
                    <tr>
                        <td>loan_amount</td>
                        <td>number</td>
                        <td>Yes</td>
                        <td>Requested loan amount</td>
                    </tr>
                    <tr>
                        <td>loan_tenure_months</td>
                        <td>number</td>
                        <td>Yes</td>
                        <td>Loan tenure in months</td>
                    </tr>
                    <tr>
                        <td>bank_statement_features</td>
                        <td>object</td>
                        <td>Yes</td>
                        <td>Features from bank statement API</td>
                    </tr>
                    <tr>
                        <td>itr_features</td>
                        <td>object</td>
                        <td>No</td>
                        <td>Features from ITR API</td>
                    </tr>
                    <tr>
                        <td>credit_report_features</td>
                        <td>object</td>
                        <td>No</td>
                        <td>Features from credit report API</td>
                    </tr>
                    <tr>
                        <td>asset_features</td>
                        <td>object</td>
                        <td>No</td>
                        <td>Features from asset API</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>Response</h2>
            <h3>Sample Output JSON</h3>
            <div class="code-block">
<pre>{
  "success": true,
  "data": {
    "credit_score": 745,
    "risk_tier": "prime",
    "default_probability": 0.045,
    "approval_recommendation": "approve",
    
    "loan_details": {
      "requested_amount": 500000,
      "approved_amount": 500000,
      "recommended_interest_rate": 10.5,
      "monthly_emi": 23100,
      "tenure_months": 24
    },
    
    "foir_analysis": {
      "monthly_income": 120000,
      "current_obligations": 22000,
      "new_emi": 23100,
      "total_obligations": 45100,
      "foir": 37.58,
      "foir_status": "acceptable"
    },
    
    "positive_factors": [
      "High income stability (0.92)",
      "Good credit score (760)",
      "Zero bounces",
      "Tax compliance excellent"
    ],
    
    "risk_factors": [
      "High FOIR after new loan (37.58%)"
    ],
    
    "recommendations": [
      "Approve loan",
      "Monitor FOIR closely",
      "Consider lower tenure if FOIR is concern"
    ]
  }
}</pre>
            </div>

            <h3>Response Fields</h3>
            <table>
                <thead>
                    <tr>
                        <th>Field</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>credit_score</td>
                        <td>Final credit score (300-900). Higher is better</td>
                    </tr>
                    <tr>
                        <td>risk_tier</td>
                        <td>prime, near_prime, standard, or subprime</td>
                    </tr>
                    <tr>
                        <td>default_probability</td>
                        <td>Probability of default (0-1)</td>
                    </tr>
                    <tr>
                        <td>approval_recommendation</td>
                        <td>approve, reject, or review</td>
                    </tr>
                    <tr>
                        <td>foir</td>
                        <td>Fixed Obligations to Income Ratio (%). Should be < 50%</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>Integration Flow</h2>
            <ol>
                <li><strong>Step 1:</strong> Call Bank Statement API → Get bank_statement_features</li>
                <li><strong>Step 2:</strong> Call ITR API → Get itr_features</li>
                <li><strong>Step 3:</strong> Call Credit Report API → Get credit_report_features</li>
                <li><strong>Step 4:</strong> (Optional) Call Asset API → Get asset_features</li>
                <li><strong>Step 5:</strong> Call Final Credit Score API with all features → Get final decision</li>
            </ol>
        </div>

        <div class="section">
            <h2>Usage Notes</h2>
            <ul>
                <li>Store all feature JSONs from individual analysis APIs</li>
                <li>Bank statement features are mandatory; others are optional but recommended</li>
                <li>More data sources = more accurate credit score</li>
                <li>FOIR above 50% indicates high risk</li>
                <li>Use approval_recommendation for automated decision making</li>
            </ul>
        </div>
    </div>
</body>
</html>

